@page "/appeal"

<PageTitle>Appeal Form</PageTitle>

<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="AppealFormPage1.css"/>
    <script src="AppealFormPage1.js"></script>
</head>
<body>
<div class="container">
    <header>
        <button id="toggle-button" class="lang-toggle" onclick="toggleLanguage()">Español</button>
    </header>
    <main>
        <EditForm Model="@appealForm1" FormName="AppealForm1" OnValidSubmit="@HandleValidSubmit">
            <DataAnnotationsValidator/>

            <section id="student-info" class="card">
                <h2 id="student-info-heading">Student Information</h2>
                <div class="form-group">
                    <label id="label-name">
                        <span class="label-text">Name:</span>
                        <InputText @bind-Value="appealForm1.Name" class="form-control" placeholder="Your name.."/>
                        <ValidationMessage For="@(() => appealForm1.Name)"/>
                    </label>
                </div>

                <div class="form-group">
                    <label id="label-student-id">
                        <span class="label-text">Student ID#:</span>
                        <InputText @bind-Value="appealForm1.StudentId" class="form-control" placeholder="ex: p000.."/>
                        <ValidationMessage For="@(() => appealForm1.StudentId)"/>
                    </label>
                </div>

                <div class="form-group">
                    <label id="label-date">
                        <span class="label-text">Date:</span>
                        <InputDate @bind-Value="appealForm1.Date" class="form-control"/>
                        <ValidationMessage For="@(() => appealForm1.Date)"/>
                    </label>
                </div>

                <div class="form-group">
                    <label id="email-name">
                        <span class="email-name">Email:</span>
                        <InputText @bind-Value="appealForm1.Email" class="form-control"/>
                        <ValidationMessage For="@(() => appealForm1.Email)"/>
                    </label>
                </div>

                <div class="form-group">
                    <label id="label-major">
                        <span class="label-text">Major:</span>
                        <InputText @bind-Value="appealForm1.Major" class="form-control" placeholder="Your major.."/>
                        <ValidationMessage For="@(() => appealForm1.Major)"/>
                    </label>
                </div>
            </section>

            <section id="appeal-details" class="card">
                <h2 id="appeal-details-heading">Appeal Explanation</h2>
                <p id="appeal-details-text">
                    Please provide a signed, typed, or written statement (max 500 words) explaining:
                </p>
                <ol id="appeal-details-list">
                    <li id = "appeal-list-1">Any extenuating circumstances that led to your SAP status.</li>
                    <li id = "appeal-list-2">How these circumstances affected your academic progress.</li>
                    <li id = "appeal-list-3">Steps you have taken to overcome them.</li>
                    <li id = "appeal-list-4">Your plan for future academic success.</li>
                </ol>
                <div class="form-group">
                    <InputTextArea @bind-Value="appealForm1.AppealExplanation"
                                   class="form-control"
                                   id="text-area"
                                   rows="6"
                                   placeholder="Write your explanation here..."
                                   onkeyup="wordLimit()"/>
                    <ValidationMessage For="@(() => appealForm1.AppealExplanation)"/>
                </div>
            </section>

            <section class="card" id="acknowledgements-section">
                <h2 id="acknowledgements-heading">Acknowledgements</h2>
                <div class="checkbox-container">
                    <input type="checkbox" id="checkbox1" required onchange="checkFormValidity()">
                    <span id="checkbox1-text">
                        Payment arrangement: I understand the Office of Financial Aid will NOT hold my classes pending a decision by the SAP committee if I am unable to pay any balance on the account.
                    </span>
                </div>
                
                <div class="checkbox-container">
                    <input type="checkbox" id="checkbox2" required onchange="checkFormValidity()">
                    <span id="checkbox2-text">
                        I understand that the decision of the Office of Financial Aid is final.
                    </span>
                </div>
            </section>

            <div class="form-actions mt-3">
                <button type="submit" id="submit-button" class="btn btn-primary" disabled>
                    @if (_isSubmitting)
                    {
                        <span>Submitting...</span>
                    }
                    else
                    {
                        <span>Submit Appeal</span>
                    }
                </button>
            </div>
        </EditForm>

        @if (_submitted)
        {
            <div class="alert alert-success mt-3">
                Form submitted successfully!
            </div>
        }

    </main>
</div>
<div class="card">
    <NavLink href="/appeal2"><button>Next Page</button></NavLink>
</div>

</body>
</html>

@code {
    private AppealFormModel1 appealForm1 = new();
    private bool _isSubmitting;
    private bool _submitted;

    protected override void OnInitialized()
    {
        appealForm1 = new AppealFormModel1
        {
            Date = DateTime.Today
        };
    }

    private void HandleValidSubmit()
    {
        Console.WriteLine("Form submitted successfully!");
        
        try
        {
            _isSubmitting = true;
            StateHasChanged();

            // Simulate API call
            AppealService.SubmitAppeal(appealForm1);
            
            _submitted = true;
            // Here you would typically navigate to a success page
            // or show a success message
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
        finally
        {
            _isSubmitting = false;
            StateHasChanged();
        }
    }
}