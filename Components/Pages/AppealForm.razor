@page "/appeal"

<PageTitle>Appeal Form</PageTitle>

<!DOCTYPE html>
<html lang="en">
<style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .container {
            display: flex;
        }
        header {
            background: #f4f4f4;
            padding: 10px 20px;
            text-align: right;
            border-bottom: 1px solid #ccc;
        }
        #toggle-button {
            background: none;
            border: none;
            color: #004080;
            text-decoration: underline;
            cursor: pointer;
            font-size: 16px;
        }

        main {
            flex-grow: 1;
            padding: 20px;
        }

        .card {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-top: 10px;
        }

        input, textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .submit-btn {
            background: #004080;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            width: 100%;
            text-align: center;
        }
    </style>
<body>
<div class="container">
    <header>
        <button id="toggle-button" onclick="toggleLanguage()">Español</button>
    </header>
    <main>
        <EditForm Model="@appealForm1" OnValidSubmit="@HandleValidSubmit">
            <DataAnnotationsValidator/>
            <ValidationSummary/>
            
            
        @if (_submitError)
        {
            <div class="alert alert-danger" role="alert">
                An error occurred while submitting the form. Please try again.
            </div>
        }
            
            <section id="student-info" class="card">
                <h2 id="student-info-heading">Student Information</h2>
                <label id="label-name">
                    <span class="label-text">Name:</span>
                    <InputText @bind-Value="appealForm1.Name" placeholder="Your name.."/>
                </label>
                <label id="label-student-id">
                    <span class="label-text">Student ID#:</span>
                    <InputText @bind-Value="appealForm1.StudentId" placeholder="ex: p000.."/>
                </label>
                <label id="label-date">
                    <span class="label-text">Date:</span>
                    <InputDate @bind-Value="appealForm1.Date"/>
                </label>
                <label id="email-name">
                    <span class="email-name">Email:</span>
                    <InputText @bind-Value="appealForm1.Email"/>
                </label>
                <label id="label-major">
                    <span class="label-text">Major:</span>
                    <InputText @bind-Value="appealForm1.Major" placeholder="Your major.."/>
                </label>
            </section>
            
            <div class="form-actions">
            <button type="submit" class="btn btn-primary" disabled="@_isSubmitting">
                @if (_isSubmitting)
                {
                    <span>Submitting...</span>
                }
                else
                {
                    <span>Submit Appeal</span>
                }
            </button>
            </div>

            <section id="appeal-details" class="card">
                <h2 id="appeal-details-heading">Appeal Explanation</h2>
                <p id="appeal-details-text">
                    Please provide a signed, typed, or written statement (max 500 words) explaining:
                </p>
                <ol id="appeal-details-list">
                    <li>Any extenuating circumstances that led to your SAP status.</li>
                    <li>How these circumstances affected your academic progress.</li>
                    <li>Steps you have taken to overcome them.</li>
                    <li>Your plan for future academic success.</li>
                </ol>
                <InputTextArea @bind-Value="appealForm1.AppealExplanation" rows="6" placeholder="Write your explanation here..."/>
            </section>

            <button type="submit" class="btn btn-primary">Submit Appeal</button>
        </EditForm>
    </main>
    </div>

<section class="card" id="acknowledgements-section">
    <!-- Changed: Added an id to the heading for language toggling -->
    <h2 id="acknowledgements-heading">Acknowledgements</h2>
    <div class="checkbox-container">
        <input type="checkbox" onclick="myFunction()">
        <!-- Changed: Added an id to the span for text updating -->
        <span id="checkbox1-text">
            Payment arrangement: I understand the Office of Financial Aid will NOT hold my classes pending a decision by the SAP committee if I am unable to pay any balance on the account.
        </span>
    </div>
    <!-- Changed: Paragraph for checked message with an id -->
    <p id="text1" style="display:none">Checkbox is CHECKED!</p>
      
    <div class="checkbox-container">
        <input type="checkbox" onclick="myFunction()">
        <span id="checkbox2-text">
            I understand that the decision of the Office of Financial Aid is final.
        </span>
    </div>
    <p id="text2" style="display:none">Checkbox is CHECKED!</p>
</section>

<script>
function myFunction() {
  var checkBox = document.getElementById("myCheck");
  var text = document.getElementById("text");
  if (checkBox.checked == true){
    text.style.display = "block";
  } else {
     text.style.display = "none";
  }
}

var currentLanguage = "en";


var translations = {
  en: {
    title: "SAP Appeal Form",
    "toggle-button": "Español",
    "documentation-label": "Official documentation supporting your extenuating circumstance(s):",
    "documentation-description": "The only acceptable forms of documentation are PDF and Word.",
    "acknowledgements-heading": "Acknowledgements",
    "checkbox1-text": "Payment arrangement: I understand the Office of Financial Aid will NOT hold my classes pending a decision by the SAP committee if I am unable to pay any balance on the account.",
    "checkbox2-text": "I understand that the decision of the Office of Financial Aid is final."
  },
  es: {
    title: "Formulario de Apelación SAP",
    "toggle-button": "English",
    "documentation-label": "Documentación oficial que respalda sus circunstancias atenuantes:",
    "documentation-description": "Las únicas formas aceptables de documentación son PDF y Word.",
    "acknowledgements-heading": "Reconocimientos",
    "checkbox1-text": "Arreglo de pago: Entiendo que la Oficina de Ayuda Financiera NO retendrá mis clases a la espera de una decisión del comité SAP si no puedo pagar el saldo de la cuenta.",
    "checkbox2-text": "Entiendo que la decisión de la Oficina de Ayuda Financiera es definitiva."
  }
};


function toggleLanguage() {
  currentLanguage = currentLanguage === "en" ? "es" : "en";
  
  document.documentElement.lang = currentLanguage;
  document.title = translations[currentLanguage].title;
  
  document.getElementById("toggle-button").innerText = translations[currentLanguage]["toggle-button"];
  document.getElementById("documentation-label").innerText = translations[currentLanguage]["documentation-label"];
  document.getElementById("documentation-description").innerText = translations[currentLanguage]["documentation-description"];
  document.getElementById("acknowledgements-heading").innerText = translations[currentLanguage]["acknowledgements-heading"];
  document.getElementById("checkbox1-text").innerText = translations[currentLanguage]["checkbox1-text"];
  document.getElementById("checkbox2-text").innerText = translations[currentLanguage]["checkbox2-text"];
}
</script>
<!-- <div class="row">
    <input type="submit" value="Submit">
</div> -->

<div class="card">
    <NavLink href="/appeal2"><button>Next Page</button></NavLink>
</div>

</body>
</html>

@code {
    private AppealFormModel1 appealForm1 = new AppealFormModel1();
    private bool _isSubmitting = false;
    private bool _submitError = false;

    private void HandleValidSubmit()
    {
        try
        {
            _isSubmitting = true;
            _submitError = false;
            
            AppealService.SubmitAppeal(appealForm1);
        }
        catch (Exception ex)
        {
            _submitError = true;
            Console.WriteLine($"Error submitting appeal: {ex.Message}");
        }
        finally
        {
            _isSubmitting = false;
        }
    }
}